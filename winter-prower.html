<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>自然在・冬日能量療癒檢測</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js for Visuals -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Lunar.js for Calendar Conversion -->
    <script src="https://cdn.jsdelivr.net/npm/lunar-javascript@1.6.12/lunar.min.js"></script>
    
    <style>
        /* 引入 Google Fonts */
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500&family=Noto+Serif+TC:wght@400;600;700&display=swap');

        :root {
            --bg-color: #0F282F; /* 深藍綠色 */
            --text-main: #E0E0E0; /* 柔和白 */
            --accent-gold: #D4AF37; /* 香檳金 */
            --accent-light: #Fdfbf7; /* 奶油白 */
            --glass-bg: rgba(255, 255, 255, 0.03);
            --glass-border: rgba(212, 175, 55, 0.3);
            --input-bg: rgba(15, 40, 47, 0.6);
            --card-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            min-height: 100vh;
            position: relative;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(21, 68, 79, 0.6) 0%, transparent 40%),
                radial-gradient(circle at 90% 80%, rgba(212, 175, 55, 0.1) 0%, transparent 30%);
            background-attachment: fixed;
        }

        /* 裝飾性背景紋理 */
        .bg-texture {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23d4af37' fill-opacity='0.05'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
            pointer-events: none;
            z-index: 0;
        }

        .content-wrapper {
            position: relative;
            z-index: 10;
        }

        /* 標題與字體 */
        h1, h2, h3, .serif-font {
            font-family: 'Noto Serif TC', serif;
        }

        /* 視覺裝飾 - 圓與線條 (模擬日出/能量/頌缽) */
        .visual-art {
            width: 100%;
            height: 140px;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            margin-bottom: 20px;
        }

        .circle-main {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: linear-gradient(135deg, rgba(212,175,55,0.15), transparent);
            border: 1px solid rgba(212,175,55,0.4);
            position: relative;
            box-shadow: 0 0 40px rgba(212,175,55,0.15);
            animation: breathe 4s ease-in-out infinite;
        }

        .circle-inner {
            position: absolute;
            width: 70px;
            height: 70px;
            border-radius: 50%;
            border: 1px solid rgba(255,255,255,0.1);
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
        }

        .line-flow {
            position: absolute;
            width: 160px;
            height: 40px;
            border-bottom: 1px solid var(--accent-gold);
            border-radius: 50%;
            top: 50%; left: 50%;
            transform: translate(-50%, -20%) rotate(-10deg);
            opacity: 0.6;
        }

        @keyframes breathe {
            0%, 100% { box-shadow: 0 0 20px rgba(212,175,55,0.1); transform: scale(1); }
            50% { box-shadow: 0 0 50px rgba(212,175,55,0.3); transform: scale(1.02); }
        }

        /* 資訊卡片容器 */
        .info-card {
            background: rgba(15, 40, 47, 0.7);
            border: 1px solid var(--glass-border);
            backdrop-filter: blur(10px);
            box-shadow: var(--card-shadow);
            border-radius: 8px;
            transition: all 0.5s ease;
        }

        /* 輸入框樣式 */
        .custom-input {
            background-color: var(--input-bg);
            border: 1px solid #455a64;
            color: #eceff1;
            transition: all 0.3s ease;
        }
        .custom-input:focus {
            border-color: var(--accent-gold);
            box-shadow: 0 0 10px rgba(212, 175, 55, 0.2);
            outline: none;
            background-color: rgba(15, 40, 47, 0.9);
        }

        /* 按鈕樣式 */
        .cta-btn {
            background: linear-gradient(45deg, #D4AF37, #bcaaa4);
            color: #0F282F;
            border: none;
            font-weight: 700;
            letter-spacing: 0.1em;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(212, 175, 55, 0.2);
        }
        .cta-btn:hover {
            background: linear-gradient(45deg, #F2D06B, #D4AF37);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(212, 175, 55, 0.4);
        }

        /* Chart Colors */
        .text-wood { color: #81c784; }
        .text-fire { color: #e57373; }
        .text-earth { color: #fff176; }
        .text-metal { color: #cfd8dc; }
        .text-water { color: #64b5f6; }

        .loader {
            border: 2px solid rgba(212, 175, 55, 0.1);
            border-top: 2px solid var(--accent-gold);
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            display: none;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Event Info Badge */
        .event-badge {
            background: rgba(212, 175, 55, 0.1);
            border: 1px solid var(--accent-gold);
            color: var(--accent-gold);
            font-size: 0.8rem;
            padding: 4px 12px;
            border-radius: 20px;
            display: inline-block;
            margin-bottom: 10px;
        }
    </style>
</head>
<body class="flex flex-col items-center py-10 px-4">

    <!-- Background Texture -->
    <div class="bg-texture"></div>

    <div class="content-wrapper w-full max-w-6xl flex flex-col items-center">
        <!-- Header -->
        <header class="text-center mb-12 relative w-full px-2">
            <span class="block text-[#D4AF37] text-xs tracking-[0.3em] uppercase mb-4 opacity-80">ZIRAN BEING</span>
            <h1 class="text-2xl sm:text-3xl md:text-5xl font-bold tracking-wider md:tracking-widest text-[#Fdfbf7] mb-4 leading-tight" style="text-shadow: 0 0 20px rgba(212, 175, 55, 0.3);">自然在・冬日能量療癒</h1>
            <div class="flex items-center justify-center gap-2 md:gap-4">
                <div class="h-[1px] w-4 md:w-8 bg-[#D4AF37] opacity-50"></div>
                <p class="text-[#b0bec5] text-xs md:text-sm tracking-wide font-light whitespace-nowrap">讓身心在自然的流動中重新歸位</p>
                <div class="h-[1px] w-4 md:w-8 bg-[#D4AF37] opacity-50"></div>
            </div>
        </header>

        <!-- Main Grid Container -->
        <div id="mainGrid" class="w-full grid grid-cols-1 md:grid-cols-12 gap-8 items-start">
            
            <!-- Left: Input Form (Originally Center, Moves to Side) -->
            <!-- Using md:col-start-5 md:col-span-4 to center it initially in a 12-col grid -->
            <div id="inputSection" class="md:col-start-5 md:col-span-4 info-card p-8 h-fit transition-all duration-700 ease-in-out relative overflow-hidden">
                
                <!-- Visual Art Decoration -->
                <div class="visual-art">
                    <div class="circle-main"></div>
                    <div class="circle-inner"></div>
                    <div class="line-flow"></div>
                </div>

                <div class="text-center mb-6">
                    <h2 class="text-xl text-[#Fdfbf7] tracking-widest mb-1">開啟能量旅程</h2>
                    <p class="text-xs text-[#78909c]">輸入生辰，探索您的五行密碼</p>
                </div>
                
                <form id="baziForm" class="space-y-5 relative z-10">
                    <div>
                        <label class="block text-xs font-bold mb-2 text-[#D4AF37] tracking-wider uppercase">Date of Birth</label>
                        <input type="date" id="birthDate" class="custom-input w-full p-3 rounded text-sm" required>
                    </div>
                    
                    <div>
                        <label class="block text-xs font-bold mb-2 text-[#D4AF37] tracking-wider uppercase">Time of Birth</label>
                        <input type="time" id="birthTime" class="custom-input w-full p-3 rounded text-sm" required>
                    </div>

                    <div>
                        <label class="block text-xs font-bold mb-2 text-[#D4AF37] tracking-wider uppercase">Gender</label>
                        <div class="relative">
                            <select id="gender" class="custom-input w-full p-3 rounded text-sm appearance-none cursor-pointer">
                                <option value="1">男 Male</option>
                                <option value="0">女 Female</option>
                            </select>
                            <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-3 text-[#D4AF37]">
                                <svg class="fill-current h-4 w-4" viewBox="0 0 20 20"><path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/></svg>
                            </div>
                        </div>
                    </div>

                    <button type="submit" class="cta-btn w-full py-4 rounded-full mt-6 text-sm">
                        開始檢測 START
                    </button>
                </form>
                <div class="loader mt-4" id="loader"></div>
            </div>

            <!-- Right: Results (Initially Hidden) -->
            <div id="resultSection" class="md:col-span-8 space-y-6 hidden opacity-0 transition-opacity duration-1000">
                
                <!-- 1. The Element Code -->
                <div class="info-card p-8">
                    <h3 class="text-lg font-bold mb-6 text-center text-[#Fdfbf7] tracking-widest border-b border-[#D4AF37]/30 pb-4">
                        <span class="text-[#D4AF37] mr-2">✦</span>自然元素圖譜<span class="text-[#D4AF37] ml-2">✦</span>
                    </h3>
                    <div class="grid grid-cols-4 gap-4 text-center">
                        <div class="flex flex-col space-y-2">
                            <span class="text-xs text-[#90a4ae] tracking-wider">年柱 (根基)</span>
                            <span class="text-2xl serif-font text-[#81c784]" id="yearPillar"></span>
                        </div>
                        <div class="flex flex-col space-y-2">
                            <span class="text-xs text-[#90a4ae] tracking-wider">月柱 (成長)</span>
                            <span class="text-2xl serif-font text-[#e57373]" id="monthPillar"></span>
                        </div>
                        <div class="flex flex-col space-y-2">
                            <span class="text-xs text-[#90a4ae] tracking-wider">日柱 (本我)</span>
                            <span class="text-2xl serif-font text-[#fff176] font-bold" id="dayPillar"></span>
                        </div>
                        <div class="flex flex-col space-y-2">
                            <span class="text-xs text-[#90a4ae] tracking-wider">時柱 (果實)</span>
                            <span class="text-2xl serif-font text-[#64b5f6]" id="hourPillar"></span>
                        </div>
                    </div>
                    <div class="mt-6 pt-4 border-t border-[#D4AF37]/10 flex justify-center space-x-8 text-sm text-[#cfd8dc]">
                        <p>節氣：<span id="lunarDateStr" class="text-[#D4AF37]"></span></p>
                        <p>生肖：<span id="zodiac" class="text-[#D4AF37]"></span></p>
                    </div>
                </div>

                <!-- 2. Chart & Distribution -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="info-card p-6 flex flex-col items-center justify-center relative">
                        <h4 class="absolute top-4 left-4 text-xs text-[#D4AF37] tracking-widest uppercase">Energy Balance</h4>
                        <div class="w-48 h-48 relative mt-4">
                            <canvas id="wuxingChart"></canvas>
                            <!-- Decorative center text -->
                            <div class="absolute inset-0 flex items-center justify-center pointer-events-none">
                                <span class="text-[#Fdfbf7] text-4xl serif-font" style="text-shadow: 0 0 15px rgba(212, 175, 55, 0.9);">氣</span>
                            </div>
                        </div>
                    </div>

                    <div class="info-card p-6">
                        <h4 class="text-xs text-[#D4AF37] tracking-widest uppercase mb-4">Five Elements</h4>
                        <ul class="space-y-3 text-sm" id="scoreList">
                            <!-- Scores injected here -->
                        </ul>
                    </div>
                </div>

                <!-- 3. Analysis & Advice -->
                <div class="info-card p-8">
                    <div class="flex items-center justify-between mb-6 border-b border-[#D4AF37]/30 pb-4">
                        <h3 class="text-lg font-bold text-[#Fdfbf7] tracking-widest">身心療癒指引</h3>
                        <span class="text-xs text-[#D4AF37] border border-[#D4AF37] px-2 py-1 rounded">AI Analysis</span>
                    </div>
                    <div id="adviceContainer" class="space-y-4">
                        <!-- Advice injected here -->
                    </div>
                </div>
                
                <!-- Event Info Card (New addition based on the draft) -->
                <div class="info-card p-6 text-center border-t-4 border-t-[#D4AF37]">
                    <h3 class="serif-font text-xl text-[#Fdfbf7] mb-2">自然在・冬日能量療癒</h3>
                    <p class="text-[#b0bec5] text-sm mb-6">透過咖啡香氣的溫度、五行能量的引導、頌缽與脈輪的共振</p>
                    
                    <div class="grid grid-cols-2 md:grid-cols-3 gap-4 text-sm mb-6">
                        <div class="p-3 bg-[#ffffff05] rounded">
                            <span class="block text-[#D4AF37] text-xs mb-1">DATE</span>
                            <span class="text-white font-bold">12.21 (Sun)</span>
                        </div>
                        <div class="p-3 bg-[#ffffff05] rounded">
                            <span class="block text-[#D4AF37] text-xs mb-1">TIME</span>
                            <span class="text-white font-bold">14:00 - 17:30</span>
                        </div>
                         <div class="p-3 bg-[#ffffff05] rounded col-span-2 md:col-span-1">
                            <span class="block text-[#D4AF37] text-xs mb-1">LOCATION</span>
                            <span class="text-white font-bold">德藝生活教室</span>
                        </div>
                    </div>
                    
                    <div class="inline-block border border-[#D4AF37] rounded px-8 py-3 bg-[#D4AF37]/10 backdrop-blur-sm">
                        <span class="text-[#Fdfbf7] font-serif tracking-widest text-lg">
                            <span class="text-[#D4AF37] mr-2">✦</span>期待與您共度療癒時光<span class="text-[#D4AF37] ml-2">✦</span>
                        </span>
                    </div>
                </div>

            </div>
        </div>

        <footer class="mt-16 text-[#607d8b] text-xs text-center tracking-widest">
            <p class="mb-2 text-[#D4AF37]">自然在 ZIRAN BEING</p>
            <p class="font-light opacity-60">© 2025 Winter Energy Healing. All rights reserved.</p>
        </footer>
    </div>

    <script>
        // --- Data Definitions ---

        const elementMap = {
            '甲': 'Wood', '乙': 'Wood', '寅': 'Wood', '卯': 'Wood',
            '丙': 'Fire', '丁': 'Fire', '巳': 'Fire', '午': 'Fire',
            '戊': 'Earth', '己': 'Earth', '辰': 'Earth', '戌': 'Earth', '丑': 'Earth', '未': 'Earth',
            '庚': 'Metal', '辛': 'Metal', '申': 'Metal', '酉': 'Metal',
            '壬': 'Water', '癸': 'Water', '亥': 'Water', '子': 'Water'
        };

        const elementNames = {
            'Wood': '木 Wood',
            'Fire': '火 Fire',
            'Earth': '土 Earth',
            'Metal': '金 Metal',
            'Water': '水 Water'
        };

        // Matching the poster aesthetic
        const elementColors = {
            'Wood': '#81c784',  // Light Green
            'Fire': '#e57373',  // Soft Red
            'Earth': '#fff176', // Soft Yellow
            'Metal': '#cfd8dc', // Blue Grey
            'Water': '#64b5f6'  // Light Blue
        };

        const adviceDB = {
            'Wood': {
                'strong': {
                    'title': '木元素・豐沛 Abundant Wood',
                    'desc': '您的內在擁有一股強大的向上生長力量，如同森林般茂密。賦予您堅定的意志，但也可能讓身心感到緊繃。',
                    'health': '留意身體的舒展度，肩膀與頸部可能較容易僵硬。',
                    'action': '體驗頌缽或金屬音療（修剪枝葉），或接觸溫暖火光（釋放能量）。'
                },
                'weak': {
                    'title': '木元素・需滋養 Nourish Wood',
                    'desc': '您的心靈像是一株需要陽光的小樹苗，渴望更多的支持與動力。',
                    'health': '容易感到眼睛疲勞或體力透支。',
                    'action': '親近森林、大樹，穿著綠色系衣物。專注於呼吸法，讓氣息向下扎根。'
                }
            },
            'Fire': {
                'strong': {
                    'title': '火元素・豐沛 Abundant Fire',
                    'desc': '您自帶溫暖與光亮，如同冬日的營火，充滿熱情。但過多的火能量可能讓情緒起伏較大。',
                    'health': '注意心血管循環與睡眠品質，避免過度興奮導致失眠。',
                    'action': '透過水的能量（如茶道、靜坐）來平衡。穿著深藍色衣物，享受片刻寧靜。'
                },
                'weak': {
                    'title': '火元素・需滋養 Nourish Fire',
                    'desc': '您的內在光芒較為內斂。在寒冷的冬日裡，可能容易手腳冰冷。',
                    'health': '需注意保暖，促進血液循環，保護心臟能量。',
                    'action': '多曬太陽，擁抱溫暖。紅色、紫色的配件能為您增添活力。'
                }
            },
            'Earth': {
                'strong': {
                    'title': '土元素・豐沛 Abundant Earth',
                    'desc': '您如同大地般厚實穩重，給人安全感。但有時過於固守原則，會讓身心變得沉重。',
                    'health': '留意消化系統的負擔，避免因壓力而暴飲暴食。',
                    'action': '需要瑜珈伸展（木）的疏通。多接觸大自然的聲音，讓固著的能量流動。'
                },
                'weak': {
                    'title': '土元素・需滋養 Nourish Earth',
                    'desc': '您的根基能量較輕盈，思緒敏捷但有時缺乏安定感。',
                    'health': '腸胃吸收能力較弱，肌肉力量較需鍛鍊。',
                    'action': '赤腳踩踏泥土、陶藝創作都能幫助接地（Grounding）。'
                }
            },
            'Metal': {
                'strong': {
                    'title': '金元素・豐沛 Abundant Metal',
                    'desc': '您的思維清晰，如同礦石般堅硬有結構。但過多的金元素可能讓您對自己太過嚴苛。',
                    'health': '注意呼吸道的保養，皮膚可能較為乾燥或敏感。',
                    'action': '需要火的溫暖來軟化剛硬，或水的流動來洗滌。學習欣賞不完美。'
                },
                'weak': {
                    'title': '金元素・需滋養 Nourish Metal',
                    'desc': '您的性格較為感性柔和，有時會因為界線不明確而受到情緒困擾。',
                    'health': '呼吸系統較弱，容易感冒，聲音可能較輕柔。',
                    'action': '白色、金色的飾品能增加您的果斷力。透過深呼吸練習，建立心理界線。'
                }
            },
            'Water': {
                'strong': {
                    'title': '水元素・豐沛 Abundant Water',
                    'desc': '您擁有極佳的適應力與智慧。但若水能量過多，思緒容易氾濫成災，陷入憂鬱。',
                    'health': '注意代謝排水系統與生殖系統的保養，避免受寒。',
                    'action': '接觸大自然的山林（土）來築堤引導情緒，或植物（木）來轉化能量。'
                },
                'weak': {
                    'title': '水元素・需滋養 Nourish Water',
                    'desc': '您的內在水分較少，反應有時較直率，缺乏一點緩衝的彈性。',
                    'health': '留意腎氣不足引起的腰痠或耳鳴，需多補充水分。',
                    'action': '黑色、藍色是您的幸運色。多喝水，聽流水的聲音，滋養內在乾涸的靈魂。'
                }
            }
        };

        // --- Core Logic ---

        let myChart = null;

        document.getElementById('baziForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // UI Handling
            document.getElementById('loader').style.display = 'block';
            
            const resultSec = document.getElementById('resultSection');
            resultSec.classList.add('hidden');
            resultSec.classList.remove('opacity-100');
            resultSec.classList.add('opacity-0');

            const dateVal = document.getElementById('birthDate').value;
            const timeVal = document.getElementById('birthTime').value;

            if(!dateVal || !timeVal) {
                alert("Please enter both date and time.");
                document.getElementById('loader').style.display = 'none';
                return;
            }

            // Simulate calculation delay for effect
            setTimeout(() => {
                analyzeBaZi(dateVal, timeVal);
                document.getElementById('loader').style.display = 'none';
                
                // Adjust Layout for Results
                const inputSection = document.getElementById('inputSection');
                // Move input to the side (col 1-4)
                inputSection.classList.remove('md:col-start-5');
                inputSection.classList.add('md:col-span-4'); 
                
                // Show Results
                resultSec.classList.remove('hidden');
                // Small delay to allow display:block to apply before opacity transition
                setTimeout(() => {
                    resultSec.classList.remove('opacity-0');
                    resultSec.classList.add('opacity-100');
                    // Scroll to results
                    resultSec.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }, 50);

            }, 800);
        });

        function analyzeBaZi(dateStr, timeStr) {
            const [year, month, day] = dateStr.split('-').map(Number);
            const [hour, minute] = timeStr.split(':').map(Number);

            const solar = Solar.fromYmdHms(year, month, day, hour, minute, 0);
            const lunar = solar.getLunar();

            const yearGanZhi = lunar.getYearInGanZhi();
            const monthGanZhi = lunar.getMonthInGanZhi();
            const dayGanZhi = lunar.getDayInGanZhi();
            const hourGanZhi = lunar.getTimeInGanZhi();

            document.getElementById('yearPillar').innerText = yearGanZhi;
            document.getElementById('monthPillar').innerText = monthGanZhi;
            document.getElementById('dayPillar').innerText = dayGanZhi;
            document.getElementById('hourPillar').innerText = hourGanZhi;

            document.getElementById('lunarDateStr').innerText = lunar.toString();
            document.getElementById('zodiac').innerText = lunar.getYearShengXiao();

            const allChars = [
                yearGanZhi[0], yearGanZhi[1],
                monthGanZhi[0], monthGanZhi[1],
                dayGanZhi[0], dayGanZhi[1],
                hourGanZhi[0], hourGanZhi[1]
            ];

            const scores = { 'Wood': 0, 'Fire': 0, 'Earth': 0, 'Metal': 0, 'Water': 0 };
            
            allChars.forEach(char => {
                const elm = elementMap[char];
                if(elm) scores[elm]++;
            });

            renderChart(scores);
            renderAdvice(scores);
        }

        function renderChart(scores) {
            const ctx = document.getElementById('wuxingChart').getContext('2d');
            
            // Changed order to: Metal (金), Wood (木), Water (水), Fire (火), Earth (土)
            const orderedKeys = ['Metal', 'Wood', 'Water', 'Fire', 'Earth'];

            const dataValues = orderedKeys.map(key => scores[key]);
            const labels = orderedKeys.map(key => elementNames[key]);
            const bgColors = orderedKeys.map(key => elementColors[key]);
            
            const listContainer = document.getElementById('scoreList');
            listContainer.innerHTML = '';
            
            let total = 8; 
            
            orderedKeys.forEach((key) => {
                const count = scores[key];
                const pct = ((count / total) * 100).toFixed(0);
                const li = document.createElement('li');
                li.className = "flex justify-between items-center p-2 border-b border-[#ffffff10] last:border-0";
                li.innerHTML = `
                    <div class="flex items-center">
                        <span class="w-2 h-2 mr-3 rounded-full" style="background-color: ${elementColors[key]}"></span>
                        <span class="text-[#cfd8dc] tracking-wide text-sm">${elementNames[key]}</span>
                    </div>
                    <div class="font-bold text-[#Fdfbf7]">
                        ${count} <span class="text-xs text-[#546e7a] font-normal ml-1">(${pct}%)</span>
                    </div>
                `;
                listContainer.appendChild(li);
            });

            if (myChart) {
                myChart.destroy();
            }

            myChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: dataValues,
                        backgroundColor: bgColors,
                        borderWidth: 0,
                        hoverOffset: 10
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '80%',
                    plugins: {
                        legend: { display: false }
                    },
                    animation: {
                        animateScale: true,
                        animateRotate: true
                    }
                }
            });
        }

        function renderAdvice(scores) {
            const container = document.getElementById('adviceContainer');
            container.innerHTML = '';

            let hasStrong = false;
            let hasWeak = false;

            const elements = ['Wood', 'Fire', 'Earth', 'Metal', 'Water'];

            elements.forEach(elm => {
                if (scores[elm] >= 3) {
                    hasStrong = true;
                    container.appendChild(createAdviceCard(elm, 'strong'));
                }
            });

            elements.forEach(elm => {
                if (scores[elm] === 0) {
                    hasWeak = true;
                    container.appendChild(createAdviceCard(elm, 'weak', true));
                }
            });

            if (!hasStrong && !hasWeak) {
                container.innerHTML = `
                    <div class="p-6 bg-[#ffffff05] border-l-4 border-[#D4AF37] rounded-r text-[#eceff1]">
                        <h4 class="font-bold mb-2 text-[#D4AF37] flex items-center">
                            五行平衡 Balanced Energy
                        </h4>
                        <p class="text-sm leading-relaxed text-[#b0bec5]">您內在的自然元素分布相當和諧，這代表一種身心流動的平衡狀態。在冬日療癒活動中，您可以更自由地體驗各種療癒項目，不需刻意補強，只需享受當下的寧靜與放鬆。</p>
                    </div>
                `;
            }
        }

        function createAdviceCard(elementKey, type) {
            const data = adviceDB[elementKey][type];
            const div = document.createElement('div');
            
            let accentColor = elementColors[elementKey];

            div.className = `p-5 rounded bg-[#ffffff05] border-l-2 mb-4 transition hover:bg-[#ffffff0a]`;
            div.style.borderLeftColor = accentColor;

            div.innerHTML = `
                <div class="flex items-center mb-3">
                    <span class="w-6 h-6 rounded-full flex items-center justify-center text-[#0F282F] text-xs font-bold mr-3" style="background-color: ${accentColor}">
                        ${elementMap[Object.keys(elementMap).find(key => elementMap[key] === elementKey)] /* Lazy way to get char, not perfect but works for icon color */}
                    </span>
                    <h4 class="font-bold text-[#Fdfbf7] text-md tracking-wide">${data.title}</h4>
                </div>
                <div class="text-sm text-[#cfd8dc] space-y-2 pl-9">
                    <p>${data.desc}</p>
                    <p class="text-xs text-[#90a4ae] mt-2"><span class="text-[#D4AF37]">✦ 建議：</span>${data.action}</p>
                </div>
            `;
            return div;
        }
    </script>
</body>
</html>